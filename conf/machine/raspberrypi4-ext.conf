#@TYPE: Machine
#@NAME: RPI4
#@NEEDED_BSPLAYERS: meta-cmf-raspberrypi
#@DESCRIPTION: Machine configuration for running a RDK Extender on RPI4
#@RDK_FLAVOR: rdkb

DEFAULTTUNE ?= "cortexa7thf-neon-vfpv4"
require conf/machine/include/tune-cortexa7.inc
include conf/machine/include/rpi-base.inc

KERNEL_DEVICETREE += " \
    bcm2711-rpi-4-b.dtb \
    bcm2711-rpi-cm4.dtb \
    overlays/disable-wifi.dtbo \
    "

MACHINE_EXTRA_RRECOMMENDS += "kernel-modules linux-firmware-bcm43430 linux-firmware-bcm43455"

IMAGE_BOOT_FILES = "bcm2835-bootfiles/* ${KERNEL_IMAGETYPE};${SDIMG_KERNELIMAGE}"
IMAGE_BOOTLOADER = "bcm2711-bootfiles"

MACHINE_IMAGE_NAME = "rdkb-generic-extender-image"
TCLIBC = "glibc"

SDIMG_KERNELIMAGE ?= "kernel7l.img"
KERNEL_DEFCONFIG ?= "bcm2711_defconfig"
UBOOT_MACHINE = "rpi_4_32b_config"
MACHINEOVERRIDES .= ":broadband:extender"
SERIAL_CONSOLE ?= "115200 ttyS0"

PREFERRED_VERSION_linux-libc-headers = "4.14.22"
PREFERRED_VERSION_xfsprogs = "4.8.0"
PREFERRED_VERSION_php = "7.1.%"
PREFERRED_VERSION_php-native = "7.1.%"

KERNEL_IMAGETYPE = "zImage"

RDKCENTRAL_GITHUB_BRANCH ?= "master"
RDKCENTRAL_GITHUB_ROOT ?= "git://github.com/rdkcentral"
RDKCENTRAL_GITHUB_PROTOCOL ?= "https"

DISTRO_FEATURES_append = " extender"
